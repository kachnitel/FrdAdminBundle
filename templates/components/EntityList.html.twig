{#
 # LiveComponent template for reactive entity lists with per-column filters.
 #
 # Props:
 # @var string entityClass - Entity class name
 # @var string search - Global search query
 # @var string sortBy - Sort field
 # @var string sortDirection - ASC or DESC
 # @var array columnFilters - Per-column filter values
 #}

<div {{ attributes }}>
    {# Global Search #}
    {% if block('search') is defined %}
        <div class="admin-global-search mb-3">
            {{ block('search') }}
        </div>
    {% else %}
        <div class="admin-global-search mb-3">
            <input
                type="text"
                class="form-control"
                placeholder="Global search across all columns..."
                data-model="search"
            >
        </div>
    {% endif %}

    {# Entity List Table #}
    <table class="table table-hover">
        <thead>
            {{ block('table_header') }}
            {{ block('table_filters') }}
        </thead>
        <tbody>
            {% for entity in this.entities %}
                {{ block('table_row') }}
            {% else %}
                <tr>
                    <td colspan="100" class="text-center text-muted py-4">
                        No {{ entityClass|replace({'App\\Entity\\': ''}) }} found.
                    </td>
                </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

{# Table header with sortable columns #}
{% block table_header %}
    <tr>
        {% for column in this.columns %}
            <th>
                <button
                    type="button"
                    class="btn btn-link p-0 text-decoration-none"
                    data-action="live#action"
                    data-live-action-param="$set('sortBy', '{{ column }}'), $set('sortDirection', sortBy === '{{ column }}' && sortDirection === 'ASC' ? 'DESC' : 'ASC')"
                >
                    {{ column|humanize }}
                    {% if sortBy == column %}
                        <span class="sort-indicator">{{ sortDirection == 'ASC' ? '▲' : '▼' }}</span>
                    {% endif %}
                </button>
            </th>
        {% endfor %}
        <th>Actions</th>
    </tr>
{% endblock %}

{# Per-column filter row #}
{% block table_filters %}
    <tr class="filters">
        {% for column in this.columns %}
            <th>
                {% if this.filterMetadata[column] is defined %}
                    {% set filter = this.filterMetadata[column] %}
                    {{ block('column_filter_' ~ filter.type, '@FrdAdmin/filters/_default.html.twig') }}
                {% endif %}
            </th>
        {% endfor %}
        <th></th>
    </tr>
{% endblock %}

{# Table row with cell rendering #}
{% block table_row %}
    <tr>
        {% for property, value in getEntityData(entity) %}
            <td>
                {% set templateName = isCollection(entity, property) ? '_collection.html.twig' : '_preview.html.twig' %}
                {{ include([
                    '@types/' ~ entityClass|replace({'\\': '/'}) ~ '/' ~ property ~ '.html.twig',
                    '@types/' ~ getPropertyType(entity, property)|replace({'\\': '/'}) ~ '/' ~ templateName,
                    '@types/' ~ templateName
                ], { cell: true }, ignore_missing = true) }}
            </td>
        {% endfor %}

        <td class="actions">
            {% if entity|hasRoute('show') and isRouteAccessible(entity|getRoute('show')) %}
                <a href="{{ objectPath(entity, 'show') }}" class="btn btn-sm btn-outline-primary">
                    <span class="material-icons">visibility</span>
                </a>
            {% endif %}

            {% if entity|hasRoute('edit') and isRouteAccessible(entity|getRoute('edit')) %}
                <a href="{{ objectPath(entity, 'edit') }}" class="btn btn-sm btn-outline-primary">
                    <span class="material-icons">edit</span>
                </a>
            {% endif %}
        </td>
    </tr>
{% endblock %}
