services:
    _defaults:
        autowire: true
        autoconfigure: true
        public: false
        bind:
            $projectDir: '%kernel.project_dir%'

    # Make controllers public
    Kachnitel\AdminBundle\Controller\:
        resource: '../src/Controller'
        tags: ['controller.service_arguments']

    # Commands
    Kachnitel\AdminBundle\Command\:
        resource: '../src/Command'
        tags: ['console.command']

    # Services
    Kachnitel\AdminBundle\Service\:
        resource: '../src/Service'

    # DataSource services (exclude DoctrineDataSource - created by factory, not a service)
    Kachnitel\AdminBundle\DataSource\:
        resource: '../src/DataSource'
        exclude: '../src/DataSource/DoctrineDataSource.php'

    # Twig Extensions
    Kachnitel\AdminBundle\Twig\Extension\:
        resource: '../src/Twig/Extension'
        exclude: '../src/Twig/Extension/AdminConfigExtension.php'
        tags: ['twig.extension']

    # Admin config extension (provides Twig globals)
    Kachnitel\AdminBundle\Twig\Extension\AdminConfigExtension:
        arguments:
            $baseLayout: '%kachnitel_admin.base_layout%'
            $theme: '%kachnitel_admin.theme%'
        tags: ['twig.extension']

    # Twig Runtimes
    Kachnitel\AdminBundle\Twig\Runtime\:
        resource: '../src/Twig/Runtime'
        tags: ['twig.runtime']

    # AdminEntityUrlRuntime with entity discovery and entity manager
    Kachnitel\AdminBundle\Twig\Runtime\AdminEntityUrlRuntime:
        arguments:
            $entityDiscovery: '@Kachnitel\AdminBundle\Service\EntityDiscoveryService'
        tags: ['twig.runtime']

    # AdminRouteRuntime with additional dependencies for permission checks
    Kachnitel\AdminBundle\Twig\Runtime\AdminRouteRuntime:
        arguments:
            $entityDiscovery: '@Kachnitel\AdminBundle\Service\EntityDiscoveryService'
            $formRegistry: '@form.registry'
            $formNamespace: '%kachnitel_admin.form_namespace%'
            $formSuffix: '%kachnitel_admin.form_suffix%'
        tags: ['twig.runtime']

    # LiveComponents
    Kachnitel\AdminBundle\Twig\Components\:
        resource: '../src/Twig/Components'
        tags: ['twig.component']

    # EntityList configuration
    Kachnitel\AdminBundle\Config\EntityListConfig:
        arguments:
            $formNamespace: '%kachnitel_admin.form_namespace%'
            $formSuffix: '%kachnitel_admin.form_suffix%'
            $defaultItemsPerPage: '%kachnitel_admin.pagination.default_items_per_page%'
            $allowedItemsPerPage: '%kachnitel_admin.pagination.allowed_items_per_page%'

    # EntityList component with pagination config
    Kachnitel\AdminBundle\Twig\Components\EntityList:
        arguments:
            $config: '@Kachnitel\AdminBundle\Config\EntityListConfig'

    # Generic Admin Controller (auto-discovers entities via #[Admin] attribute)
    Kachnitel\AdminBundle\Controller\GenericAdminController:
        arguments:
            $entityDiscovery: '@Kachnitel\AdminBundle\Service\EntityDiscoveryService'
            $routePrefix: '%kachnitel_admin.route_prefix%'
            $dashboardRoute: '%kachnitel_admin.dashboard_route%'
            $entityNamespace: '%kachnitel_admin.entity_namespace%'
            $requiredRole: '%kachnitel_admin.required_role%'
        tags: ['controller.service_arguments']

    # Security Voter for entity admin access control
    Kachnitel\AdminBundle\Security\AdminEntityVoter:
        arguments:
            $entityDiscovery: '@Kachnitel\AdminBundle\Service\EntityDiscoveryService'
            $defaultRequiredRole: '%kachnitel_admin.required_role%'
            $entityNamespace: '%kachnitel_admin.entity_namespace%'
            $roleHierarchy: '@?security.role_hierarchy'
        tags: ['security.voter']
